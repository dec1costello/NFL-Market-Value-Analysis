name: Displaying commenter's name under new issue

on:
  workflow_dispatch:
  issues:
    types: [opened, edited]

permissions:
  issues: write

jobs:
  comment:
    runs-on: ubuntu-latest

    steps:
      - name: Dump GitHub event
        run: echo '${{ toJSON(github.event) }}' | jq

      - name: Comment on issue
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          USER: ${{ github.event.issue.user.login }}
          EDITOR: ${{ github.event.sender.login }}
          ACTION: ${{ github.event.action }}
        run: |
          if [ "$ACTION" = "opened" ]; then
            BODY="Thanks **@$USER** for opening this issue. We will take a look into it ASAP.\n- Please make sure enough details are provided. ✨"
          elif [ "$ACTION" = "edited" ]; then
            BODY="Thanks **@$EDITOR** for editing this issue. We will take a look into it ASAP.\n- Please make sure the title is descriptive. ✨"
          else
            echo "No comment for this action ($ACTION)"
            exit 0
          fi

          curl -s -X POST \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/$REPO/issues/$ISSUE_NUMBER/comments \
            -d "$(jq -n --arg body "$BODY" '{body: $body}')"

      - name: Finished
        run: echo "Done commenting."
